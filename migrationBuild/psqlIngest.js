!function(e){var n={};function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var o in e)t.d(r,o,function(n){return e[n]}.bind(null,o));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=3)}([function(e,n){e.exports=require("fs")},function(e,n){e.exports=require("pg")},,function(e,n,t){"use strict";t.r(n);var r=t(0),o=t(1),i=function(e,n,t,r){return new(t||(t=Promise))(function(o,i){function s(e){try{d(r.next(e))}catch(e){i(e)}}function a(e){try{d(r.throw(e))}catch(e){i(e)}}function d(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t(function(e){e(n)})).then(s,a)}d((r=r.apply(e,n||[])).next())})};4!==process.argv.length&&(console.log("Usage: node psqlInjest.js CONFIG_FILE DUMP_FILE"),process.exit(1));const s=JSON.parse(r.readFileSync(process.argv[2],{encoding:"utf8"})),a=JSON.parse(r.readFileSync(process.argv[3],{encoding:"utf8"}));console.log(`Injesting ${a.players.length} players, ${a.hands.length} hands, and ${a.playerHands.length} player hands.`);const d=new o.Client(s);function l(e){return Object.assign(Object.assign({},e),{slam:!!e.slam})}function c(e){return Object.assign(Object.assign({},e),{isBidder:!!e.isBidder,isPartner:!!e.isPartner,showed:!!e.showed,oneLast:!!e.oneLast})}function u(e,n,t,r){return i(this,void 0,void 0,function*(){const o=function(e,n=100){const t=[];for(;e.length>0;)t.push(e.splice(0,n));return t}(t,r);for(const t of o)yield f(e,n,t);yield function(e,n="id"){return i(this,void 0,void 0,function*(){const t=`${e}_${n}_seq`,r=yield d.query(`SELECT max(${n}) FROM ${e}`),o=r.rows[0].max;yield d.query(`ALTER SEQUENCE ${t} RESTART ${o+1}`)})}(e),console.log("Injested into table "+e)})}function f(e,n,t){return i(this,void 0,void 0,function*(){const r=n.map(e=>e[0]),o=t.map(e=>(function(e,n){return"("+n.map(n=>void 0===e[n]?"null":`'${e[n]}'`).join(", ")+")"})(e,r)).join(", "),i=n.map(e=>e[1]).join(", "),s=`INSERT INTO ${e} (${i}) VALUES ${o}`;yield d.query(s)})}!function(){i(this,void 0,void 0,function*(){console.log("foo"),yield d.connect(),console.log("bar");try{const e=[["id","id"],["firstName","first_name"],["lastName","last_name"]];yield u("players",e,a.players,10);const n=[["id","id"],["timestamp","timestamp"],["players","players"],["bidder","bidder_fk_id"],["partner","partner_fk_id"],["bidAmount","bid_amt"],["points","points"],["slam","slam"]];yield u("hand",n,a.hands.map(l),100);const t=[["id","id"],["timestamp","timestamp"],["hand","hand_fk_id"],["player","player_fk_id"],["isBidder","was_bidder"],["isPartner","was_partner"],["showed","showed_trump"],["oneLast","one_last"],["points","points_earned"]];yield u("player_hand",t,a.playerHands.map(c),100)}finally{d.end()}})}()}]);