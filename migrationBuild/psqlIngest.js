!function(e){var n={};function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var i in e)t.d(r,i,function(n){return e[n]}.bind(null,i));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=4)}([function(e,n){e.exports=require("fs")},,function(e,n){e.exports=require("pg")},,function(e,n,t){"use strict";t.r(n);var r=t(2),i=t(0),o=function(e,n,t,r){return new(t||(t=Promise))(function(i,o){function s(e){try{d(r.next(e))}catch(e){o(e)}}function a(e){try{d(r.throw(e))}catch(e){o(e)}}function d(e){e.done?i(e.value):new t(function(n){n(e.value)}).then(s,a)}d((r=r.apply(e,n||[])).next())})};4!==process.argv.length&&(console.log("Usage: node psqlInjest.js CONFIG_FILE DUMP_FILE"),process.exit(1));const s=JSON.parse(i.readFileSync(process.argv[2],{encoding:"utf8"})),a=JSON.parse(i.readFileSync(process.argv[3],{encoding:"utf8"}));console.log(`Injesting ${a.players.length} players, ${a.hands.length} hands, and ${a.playerHands.length} player hands.`);const d=new r.Client(s);function u(e){return Object.assign({},e,{slam:!!e.slam})}function l(e){return Object.assign({},e,{isBidder:!!e.isBidder,isPartner:!!e.isPartner,showed:!!e.showed,oneLast:!!e.oneLast})}function c(e,n,t,r){return o(this,void 0,void 0,function*(){const i=function(e,n=100){const t=[];for(;e.length>0;)t.push(e.splice(0,n));return t}(t,r);for(const t of i)yield p(e,n,t);yield function(e,n="id"){return o(this,void 0,void 0,function*(){const t=`${e}_${n}_seq`,r=yield d.query(`SELECT max(${n}) FROM ${e}`),i=r.rows[0].max;yield d.query(`ALTER SEQUENCE ${t} RESTART ${i}`)})}(e),console.log("Injested into table "+e)})}function p(e,n,t){return o(this,void 0,void 0,function*(){const r=n.map(e=>e[0]),i=t.map(e=>(function(e,n){return"("+n.map(n=>void 0===e[n]?"null":`'${e[n]}'`).join(", ")+")"})(e,r)).join(", "),o=n.map(e=>e[1]).join(", "),s=`INSERT INTO ${e} (${o}) VALUES ${i}`;yield d.query(s)})}!function(){o(this,void 0,void 0,function*(){yield d.connect();try{const e=[["id","id"],["firstName","first_name"],["lastName","last_name"]];yield c("players",e,a.players,10);const n=[["id","id"],["timestamp","timestamp"],["players","players"],["bidder","bidder_fk_id"],["partner","partner_fk_id"],["bidAmount","bid_amt"],["points","points"],["slam","slam"]];yield c("hand",n,a.hands.map(u),100);const t=[["id","id"],["timestamp","timestamp"],["hand","hand_fk_id"],["player","player_fk_id"],["isBidder","was_bidder"],["isPartner","was_partner"],["showed","showed_trump"],["oneLast","one_last"],["points","points_earned"]];yield c("player_hand",t,a.playerHands.map(l),100)}finally{d.end()}})}()}]);